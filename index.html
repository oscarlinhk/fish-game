<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é­šè¦èŸ¹æ¡ŒéŠç‰ˆ v5.0</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --red: #d32f2f; --green: #388e3c; --blue: #1976d2; --gold: #fbc02d; }
        body { font-family: -apple-system, sans-serif; background: #8e0000; margin: 0; text-align: center; color: white; overflow: hidden; }
        
        .view { display: none; height: 100vh; flex-direction: column; align-items: center; justify-content: center; }
        .active { display: flex !important; }

        /* è³­æª¯ä½ˆå±€ */
        .table-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 15px; 
            width: 95vw; 
            max-width: 900px; 
            margin-top: 10px;
        }
        .bet-zone { 
            background: #006400; /* æ·±ç¶ è‰²æ¡Œå¸ƒæ„Ÿ */
            border: 4px solid #fff;
            border-radius: 20px;
            padding: 40px 10px;
            position: relative;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.5);
            transition: all 0.1s;
            -webkit-tap-highlight-color: transparent;
        }
        .bet-zone:active { background: #004d00; transform: scale(0.98); }
        .bet-zone .icon { font-size: 80px; display: block; margin-bottom: 10px; }
        .bet-zone b { font-size: 24px; }

        /* ç±Œç¢¼é¡¯ç¤º */
        .chip-stack {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: var(--gold);
            color: black;
            width: 45px;
            height: 45px;
            line-height: 45px;
            border-radius: 50%;
            border: 3px dashed black;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 4px 0 #b8860b;
        }

        /* ç±Œç¢¼é¢é¡é¸æ“‡å™¨ */
        .chip-selector {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .chip-btn {
            width: 60px; height: 60px; border-radius: 50%; border: 4px solid white;
            font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .chip-100 { background: #fff; color: #000; }
        .chip-500 { background: var(--blue); color: #fff; }
        .chip-1000 { background: var(--red); color: #fff; }
        .chip-selected { border-color: var(--gold); transform: scale(1.2); box-shadow: 0 0 15px var(--gold); }

        /* é ‚éƒ¨è³‡è¨Šæ¬„ */
        .info-bar { width: 100%; display: flex; justify-content: space-around; align-items: center; padding: 15px 0; background: rgba(0,0,0,0.3); }
        .dice-display { display: flex; gap: 10px; margin: 10px 0; }
        .die { width: 70px; height: 70px; background: white; border-radius: 12px; font-size: 45px; display: flex; align-items: center; justify-content: center; }
        .rolling { animation: shake 0.1s infinite; }
        @keyframes shake { 0% { transform: translate(2px, 2px); } 50% { transform: translate(-2px, -2px); } 100% { transform: translate(2px, -2px); } }

        button.action-btn { padding: 10px 25px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div id="view-start" class="view active">
        <h1>ğŸ§§ é­šè¦èŸ¹ï¼šè³€æ­²è³­æª¯</h1>
        <button class="btn" onclick="startAsHost()" style="padding:20px 40px; font-size:24px; border-radius:15px; border:none;">é–‹å•Ÿ iPad è³­æª¯æ¨¡å¼</button>
        <p>ï¼ˆå¦‚æœè¦ç”¨æ‰‹æ©Ÿç•¶æ–ç›…ï¼Œè«‹é»æ“Šä¸‹æ–¹ï¼‰</p>
        <button onclick="startAsController()" style="background:none; color:white; border:1px solid white; padding:10px 20px; border-radius:10px;">æ‰‹æ©Ÿæ§åˆ¶ç«¯</button>
    </div>

    <div id="view-host" class="view">
        <div class="info-bar">
            <div>é€£ç·šç¢¼: <b id="peer-id" style="color:var(--gold)">...</b></div>
            <div style="font-size:24px;">é¤˜é¡: $<span id="balance">5000</span></div>
            <button class="action-btn" onclick="undoLastBet()" style="background:#666; color:white;">â†©ï¸ æ’¤å›</button>
        </div>

        <div class="dice-display">
            <div id="d1" class="die">?</div><div id="d2" class="die">?</div><div id="d3" class="die">?</div>
        </div>

        <div class="table-grid" id="main-board"></div>

        <div class="chip-selector">
            <div class="chip-btn chip-100 chip-selected" onclick="selectDenom(100, this)">100</div>
            <div class="chip-btn chip-500" onclick="selectDenom(500, this)">500</div>
            <div class="chip-btn chip-1000" onclick="selectDenom(1000, this)">1k</div>
        </div>
        
        <p id="host-msg">å¤šäººå¯åŒæ™‚åœ¨è¢å¹•ä¸‹æ³¨</p>
    </div>

    <div id="view-controller" class="view">...</div>

<script>
    const symbols = [
        { name: 'é­š', icon: 'ğŸŸ' }, { name: 'è¦', icon: 'ğŸ¦' },
        { name: 'è‘«è˜†', icon: 'ğŸ¶' }, { name: 'é‡‘éŒ¢', icon: 'ğŸ’°' },
        { name: 'èŸ¹', icon: 'ğŸ¦€' }, { name: 'é›', icon: 'ğŸ“' }
    ];

    let balance = 5000, bets = [0,0,0,0,0,0], selectedDenom = 100, betHistory = [];

    function selectDenom(amt, el) {
        selectedDenom = amt;
        document.querySelectorAll('.chip-btn').forEach(b => b.classList.remove('chip-selected'));
        el.classList.add('chip-selected');
    }

    function startAsHost() {
        showView('view-host');
        const board = document.getElementById('main-board');
        symbols.forEach((s, i) => {
            const div = document.createElement('div');
            div.className = 'bet-zone';
            div.innerHTML = `<span class="icon">${s.icon}</span><b>${s.name}</b><div class="chip-stack" id="c-${i}" style="display:none">0</div>`;
            div.onclick = () => placeBet(i);
            board.appendChild(div);
        });

        const shortId = Math.floor(1000 + Math.random() * 9000);
        peer = new Peer('fpc-' + shortId);
        peer.on('open', id => document.getElementById('peer-id').innerText = id.replace('fpc-', ''));
        peer.on('connection', c => {
            c.on('data', data => { if(data === 'ROLL') performRoll(); });
        });
    }

    function placeBet(i) {
        if (balance >= selectedDenom) {
            balance -= selectedDenom;
            bets[i] += selectedDenom;
            betHistory.push({ index: i, amount: selectedDenom });
            updateUI();
        }
    }

    function undoLastBet() {
        if (betHistory.length > 0) {
            const last = betHistory.pop();
            balance += last.amount;
            bets[last.index] -= last.amount;
            updateUI();
        }
    }

    function updateUI() {
        document.getElementById('balance').innerText = balance;
        bets.forEach((amt, i) => {
            const el = document.getElementById(`c-${i}`);
            el.innerText = amt >= 1000 ? (amt/1000)+'k' : amt;
            el.style.display = amt > 0 ? 'block' : 'none';
        });
    }

    function performRoll() {
        if (bets.reduce((a, b) => a + b, 0) === 0) return alert("è«‹å…ˆä¸‹æ³¨ï¼");
        const dice = [document.getElementById('d1'), document.getElementById('d2'), document.getElementById('d3')];
        dice.forEach(d => d.classList.add('rolling'));
        setTimeout(() => {
            const res = [Math.floor(Math.random()*6), Math.floor(Math.random()*6), Math.floor(Math.random()*6)];
            dice.forEach((d, i) => { d.classList.remove('rolling'); d.innerText = symbols[res[i]].icon; });
            
            let win = 0, back = 0;
            bets.forEach((bet, i) => {
                const matches = res.filter(r => r === i).length;
                if (matches > 0) { win += bet * matches; back += bet; }
            });
            balance += (win + back);
            bets = [0,0,0,0,0,0];
            betHistory = [];
            setTimeout(() => { updateUI(); alert(win > 0 ? "ğŸ‰ è´äº† $" + win : "æ²’ä¸­çï¼"); }, 500);
        }, 1200);
    }

    function showView(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
</script>
</body>
</html>
